var Otto=function(){"use strict";function e(e,t,i){var o=this;if(this.config=t||{},this.allChoices=i||[],!this.isObject(this.config))throw"Otto Error: `config` must be an object.";if(!Array.isArray(this.allChoices))throw"Otto Error: `choices` must be an array of objects.";this.allChoices.forEach(function(e){if(!o.isObject(e)||!e.label)throw"Otto Error: All choices must be objects with a `label` attribute."}),this.inputValue="",this.selected=null,this.filteredChoices=[],this.cache={},this.minChars=this.config.minChars||3,this.maxResults=this.config.maxResults||7,this.source=this.config.source||null,this.redrawTimer=null,this.root=this.createRoot(e),this.dropdown=this.createDropdown(this.root,this.config.divClass||""),this.ul=this.createUnorderedList(this.config.ulClass||""),this.dropdown.appendChild(this.ul),this.root.insertAdjacentElement("afterend",this.dropdown),window.addEventListener("resize",function(){return o.setRedrawTimer()}),this.updateList()}return e.prototype.isObject=function(e){return null!==e&&e.constructor===Object},e.prototype.removeHTML=function(e){return e.replace(/&/g,"").replace(/</g,"").replace(/>/g,"")},e.prototype.setRedrawTimer=function(){var e=this;this.redrawTimer&&clearTimeout(this.redrawTimer),this.redrawTimer=setTimeout(function(){e.dropdown.style.width=e.root.offsetWidth.toString()+"px",e.dropdown.style.top=(e.root.offsetHeight+e.root.offsetTop+2).toString()+"px",e.dropdown.style.left=e.root.offsetLeft.toString()+"px"},500)},e.prototype.applyFilter=function(){var a=this,c=this.inputValue.toUpperCase(),h=c.length,e=this.allChoices.filter(function(e){var t=e.matchOn||e.label,i=t.toUpperCase().indexOf(c),o=!a.config.matchFullWord||(void 0===t[i-1]||" "===t[i-1]);return-1<i&&o});this.filteredChoices=e.map(function(e){var t={},i=a.removeHTML(e.label),o=i.toUpperCase().indexOf(c);if(t.label=e.label,t.value=e.value||e.label,o<0)t.emLabel=i;else{var s=i.slice(0,o),n=i.slice(o,o+h),l=i.slice(o+h);t.emLabel=s+"<b>"+n+"</b>"+l}for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r]);return t})},e.prototype.updateList=function(){var i=this;this.ul.innerHTML="",this.filteredChoices.forEach(function(e){var t=i.createListElement(e,i.config.liClass||"");i.ul.appendChild(t)}),this.filteredChoices.length<1?this.dropdown.style.display="none":this.root===document.activeElement&&(this.dropdown.style.display="")},e.prototype.fetchFromSource=function(){var t=this,i=this.inputValue.toUpperCase();this.cache[i]?(this.allChoices=this.cache[i],this.applyFilter(),this.updateList()):this.source(this.inputValue,function(e){t.allChoices=e||[],t.cache[i]=[].concat(t.allChoices),0<t.inputValue.length&&(t.applyFilter(),t.updateList())})},e.prototype.handleInput=function(e){this.inputValue=e.target.value,this.selected=null,this.config.valueEvent&&this.config.valueEvent(this.inputValue),this.inputValue.length>=this.minChars?this.config.source?this.fetchFromSource():(this.applyFilter(),this.updateList()):(this.filteredChoices=[],this.updateList())},e.prototype.handleEnter=function(e){this.selected&&(this.inputValue=this.root.value=this.selected.value,this.filteredChoices=[],this.config.valueEvent&&this.config.valueEvent(this.inputValue),this.config.selectEvent&&this.config.selectEvent(this.selected)),this.config.enterEvent&&"none"===this.dropdown.style.display&&this.config.enterEvent(e),this.dropdown.style.display="none"},e.prototype.handleUpDown=function(e){var t=this.ul.getElementsByClassName("otto-li"),i=t.length,o=null,s=null;if(0<i){for(var n=0;n<i;n++)-1<t[n].className.indexOf("otto-selected")&&(o=n);if(40==e.keyCode?s=1:38==e.keyCode&&(s=-1),1===s&&null===o)t[0].className=NaN,this.selected=t[0].choice;else if(null!==s){var l=o+s;t[o].className=t[o].className.replace(" otto-selected",""),t[l].className+=" otto-selected",this.selected=t[l].choice}}},e.prototype.clearSelected=function(){var e=this.ul.getElementsByClassName("otto-li otto-selected");0<e.length&&(e[0].className=e[0].className.replace(" otto-selected",""))},e.prototype.createRoot=function(e){var t=this,i=e;return i.autocomplete="off",i.addEventListener("keydown",function(e){38==e.keyCode||40==e.keyCode?(e.preventDefault(),t.handleUpDown(e)):13==e.keyCode&&e.preventDefault()}),i.addEventListener("keyup",function(e){13==e.keyCode&&(e.preventDefault(),t.handleEnter(e))}),i.addEventListener("input",function(e){t.handleInput(e)}),i.addEventListener("focus",function(){t.setRedrawTimer(),0<t.filteredChoices.length&&(t.dropdown.style.display="")}),i.addEventListener("blur",function(e){t.dropdown.style.display="none"}),this.config.events&&Object.keys(this.config.events).forEach(function(e){i.addEventListener(e,t.config.events[e])}),i},e.prototype.createDropdown=function(e,t){var i=document.createElement("div");return i.className="otto-dev "+t,i.style.width=e.offsetWidth.toString()+"px",i.style.top=(e.offsetHeight+e.offsetTop+2).toString()+"px",i.style.left=e.offsetLeft.toString()+"px",i.style.backgroundColor="white",i.style.position="absolute",i.style.overflow="hidden",i.style.zIndex="9999",i.style.display="none",i},e.prototype.createUnorderedList=function(e){var t=document.createElement("ul");return t.className="otto-ul "+e,t},e.prototype.createListElement=function(e,t){var i=this,o=document.createElement("li");return o.className="otto-li "+t,o.choice=e,o.style.listStyleType="none",o.style.cursor="default",this.config.renderItem?o.innerHTML=this.config.renderItem(e):o.innerHTML=e.emLabel,o.addEventListener("mouseenter",function(e){i.clearSelected(),e.target.className+=" otto-selected",i.selected=e.target.choice}),o.addEventListener("mouseleave",function(e){e.target.className=e.target.className.replace(" otto-selected",""),i.selected=null}),o.addEventListener("mousedown",function(){i.inputValue=i.root.value=i.selected.value,i.filteredChoices=[],i.config.valueEvent&&i.config.valueEvent(i.inputValue),i.config.selectEvent&&i.config.selectEvent(i.selected)}),o},e}();

var Otto=function(){"use strict";function f(e,t){for(var n=arguments,r=[],l=[],o=arguments.length;2<o--;)r.push(n[o]);for(;r.length;){var u=r.pop();if(u&&u.pop)for(o=u.length;o--;)r.push(u[o]);else null!=u&&!0!==u&&!1!==u&&l.push(u)}return"function"==typeof e?e(t||{},l):{nodeName:e,attributes:t||{},children:l,key:t&&t.key}}function c(e,t,n,r){var l,o=[].map,u=r&&r.children[0]||null,i=u&&function t(e){return{nodeName:e.nodeName.toLowerCase(),attributes:{},children:o.call(e.childNodes,function(e){return 3===e.nodeType?e.nodeValue:t(e)})}}(u),c=[],m=!0,s=p(e),a=function e(r,l,o){for(var t in o)"function"==typeof o[t]?function(e,n){o[e]=function(e){var t=n(e);return"function"==typeof t&&(t=t(v(r,s),o)),t&&t!==(l=v(r,s))&&!t.then&&f(s=h(r,p(l,t),s)),t}}(t,o[t]):e(r.concat(t),l[t]=p(l[t]),o[t]=p(o[t]));return o}([],s,p(t));return f(),a;function y(e){return"function"==typeof e?y(e(s,a)):null!=e?e:""}function d(){l=!l;var e=y(n);for(r&&!l&&(u=function e(t,n,r,l,o){if(l===r);else if(null==r||r.nodeName!==l.nodeName){var u=S(l,o);t.insertBefore(u,n),null!=r&&O(t,n,r),n=u}else if(null==r.nodeName)n.nodeValue=l;else{g(n,r.attributes,l.attributes,o=o||"svg"===l.nodeName);for(var i={},c={},s=[],a=r.children,d=l.children,f=0;f<a.length;f++){s[f]=n.childNodes[f];var p=b(a[f]);null!=p&&(i[p]=[s[f],a[f]])}for(var f=0,h=0;h<d.length;){var p=b(a[f]),v=b(d[h]=y(d[h]));if(c[p])f++;else if(null==v||v!==b(a[f+1]))if(null==v||m)null==p&&(e(n,s[f],a[f],d[h],o),h++),f++;else{var w=i[v]||[];p===v?(e(n,w[0],w[1],d[h],o),f++):w[0]?e(n,n.insertBefore(w[0],s[f]),w[1],d[h],o):e(n,s[f],null,d[h],o),c[v]=d[h],h++}else null==p&&O(n,s[f],a[f]),f++}for(;f<a.length;)null==b(a[f])&&O(n,s[f],a[f]),f++;for(var f in i)c[f]||O(n,i[f][0],i[f][1])}return n}(r,u,i,i=e)),m=!1;c.length;)c.pop()()}function f(){l||(l=!0,setTimeout(d))}function p(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}function h(e,t,n){var r={};return e.length?(r[e[0]]=1<e.length?h(e.slice(1),t,n[e[0]]):t,p(n,r)):t}function v(e,t){for(var n=0;n<e.length;)t=t[e[n++]];return t}function b(e){return e?e.key:null}function w(e){return e.currentTarget.events[e.type](e)}function C(e,t,n,r,l){if("key"===t);else if("style"===t)if("string"==typeof n)e.style.cssText=n;else for(var o in"string"==typeof r&&(r=e.style.cssText=""),p(r,n)){var u=null==n||null==n[o]?"":n[o];"-"===o[0]?e.style.setProperty(o,u):e.style[o]=u}else"o"===t[0]&&"n"===t[1]?(t=t.slice(2),e.events?r||(r=e.events[t]):e.events={},(e.events[t]=n)?r||e.addEventListener(t,w):e.removeEventListener(t,w)):t in e&&"list"!==t&&"type"!==t&&"draggable"!==t&&"spellcheck"!==t&&"translate"!==t&&!l?e[t]=null==n?"":n:null!=n&&!1!==n&&e.setAttribute(t,n),null!=n&&!1!==n||e.removeAttribute(t)}function S(e,t){var n="string"==typeof e||"number"==typeof e?document.createTextNode(e):(t=t||"svg"===e.nodeName)?document.createElementNS("http://www.w3.org/2000/svg",e.nodeName):document.createElement(e.nodeName),r=e.attributes;if(r){r.oncreate&&c.push(function(){r.oncreate(n)});for(var l=0;l<e.children.length;l++)n.appendChild(S(e.children[l]=y(e.children[l]),t));for(var o in r)C(n,o,r[o],null,t)}return n}function g(e,t,n,r){for(var l in p(t,n))n[l]!==("value"===l||"checked"===l?e[l]:t[l])&&C(e,l,n[l],t[l],r);var o=m?n.oncreate:n.onupdate;o&&c.push(function(){o(e,t)})}function O(e,t,n){function r(){e.removeChild(function e(t,n){var r=n.attributes;if(r){for(var l=0;l<n.children.length;l++)e(t.childNodes[l],n.children[l]);r.ondestroy&&r.ondestroy(t)}return t}(t,n))}var l=n.attributes&&n.attributes.onremove;l?l(t,r):r()}}var l=function(a,d){return function(t,e){var n,r,l,o,u,i,c,s={key:a.value,class:("otto-li "+t.liClass+" "+(d?"otto-selected":"")).trim(),style:{listStyleType:"none",cursor:"default"},onmousedown:function(){e.setChoiceAndInputVal(a),e.applyFilter(),e.focusInputAndHideDropdown()}};return t.renderItem?(s.oncreate=function(e){return e.innerHTML=t.renderItem(a,t.inputVal)},f("li",s)):-1<a.matchOn.toUpperCase().indexOf(t.inputVal.toUpperCase())?f("li",s,-1<a.label.toUpperCase().indexOf(t.inputVal.toUpperCase())?(n=a,r=t.inputVal,c=n.label,l=c.replace(/&/g,"").replace(/</g,"").replace(/>/g,""),o=r.length,u=l.toUpperCase().indexOf(r.toUpperCase()),[(i={beg:l.slice(0,u),mid:l.slice(u,u+o),end:l.slice(u+o)}).beg,f("b",{},i.mid),i.end]):a.label):null}};var t=function(){return function(e){return f("div",{class:("otto-div "+e.dropdownClass).trim(),style:{width:e.width,backgroundColor:"white",position:"absolute",overflow:"hidden",zIndex:"99"}},(t=e.filtered,function(r){return f("ul",{class:("otto-ul "+r.ulClass).trim()},t.length?t.map(function(e,t){var n=t===r.selected;return l(e,n)}):f("li",{},"nothing here"))}));var t}},s=function(){return function(e){return f("div",{class:e.divClass},[function(n,r){return f("input",{class:n.inputClass,autocomplete:"off",value:n.inputVal,oninput:function(e){var t=e.target.value;r.setInputVal(t),t&&t.trim().length>=n.minChars?n.source?r.fetchFromSource():(r.applyFilter(),r.setShowDropdownOnFiltered(),r.setSelectedOnShowDropdown()):(r.setFiltered([]),r.setShowDropdownOnFiltered(),r.setSelectedOnShowDropdown())},onfocus:function(){r.setShowDropdownOnFiltered()},onblur:function(){r.setShowDropdown(!1),r.setSelected(null)},onkeydown:function(e){38!=e.keyCode&&40!=e.keyCode||n.showDropdown&&(e.preventDefault(),38==e.keyCode&&r.decrementSelected(),40==e.keyCode&&r.incrementSelected()),9!=e.keyCode&&13!=e.keyCode||(n.showDropdown?(e.preventDefault(),r.setChoiceOnSelected(),r.applyFilter(),r.setSelected(null),r.setShowDropdown(!1)):13==e.keyCode&&n.enterEvent&&n.enterEvent(e))},oncreate:function(t){r.setInputRef(t),n.events&&Object.keys(n.events).forEach(function(e){t.addEventListener(e,n.events[e])})}})},e.showDropdown?t():null])}},a={setAll:function(e){return{all:e}},setFiltered:function(e){return{filtered:e}},setShowDropdown:function(e){return{showDropdown:e}},setSelected:function(e){return{selected:e}},setInputRef:function(e){return{inputRef:e}},setInputVal:function(t){return function(e){return e.valueEvent&&e.valueEvent(t),{inputVal:t}}},addToCache:function(n){return function(e){var t=Object.assign({},e.cache);return t[n]=[].concat(e.all),{cache:t}}},focusInputAndHideDropdown:function(){return function(e,t){setTimeout(function(){e.inputRef.focus(),t.setShowDropdown(!1)})}},setChoiceAndInputVal:function(n){return function(e,t){return e.selectEvent&&e.selectEvent(n),t.setInputVal(n.value),{choice:n}}},fetchFromSource:function(){return function(e,n){var r=e.inputVal.toUpperCase().trim();e.cache[r]?(n.setAll(e.cache[r]),n.applyFilter(),n.setShowDropdownOnFiltered(),n.setSelectedOnShowDropdown()):e.source(e.inputVal,function(e){var t=e||[];t=t.map(function(e){return Object.assign({},e,{label:e.label,matchOn:e.matchOn||e.label,value:e.value||e.label})}),n.setAll(t),n.addToCache(r),n.applyFilter(),n.setShowDropdownOnFiltered(),n.setSelectedOnShowDropdown()})}},applyFilter:function(){return function(l,e){var o=l.inputVal,t=l.all.filter(function(e){o=o.toUpperCase();var t=e.matchOn,n=t.toUpperCase().indexOf(o),r=!l.matchFullWord||(void 0===t[n-1]||" "===t[n-1]);return-1<n&&r});t=t.slice(0,l.maxResults),e.setFiltered(t)}},setShowDropdownOnFiltered:function(){return function(e,t){e.filtered.length?t.setShowDropdown(!0):t.setShowDropdown(!1)}},setSelectedOnShowDropdown:function(){return function(e,t){e.showDropdown||t.setSelected(null)}},setChoiceOnSelected:function(){return function(e,t){if(null!==e.selected){var n=e.filtered[e.selected];t.setChoiceAndInputVal(n)}}},incrementSelected:function(){return function(e,t){if(e.showDropdown)if(null===e.selected)t.setSelected(0);else{if(e.selected===e.filtered.length-1)return;t.setSelected(e.selected+1)}else t.setSelected(null)}},decrementSelected:function(){return function(e,t){e.showDropdown?null===e.selected||0===e.selected?t.setSelected(0):t.setSelected(e.selected-1):t.setSelected(null)}}};function e(e,t,n){var r=this;if(!this.isObject(t))throw"Otto Error: `config` must be an object.";if(void 0!==n&&!Array.isArray(n))throw"Otto Error: `choices` must be an array of objects.";void 0!==n&&(n.forEach(function(e){if(!r.isObject(e)||!e.label)throw"Otto Error: All choices must be objects with a `label` attribute."}),n=n.map(function(e){return Object.assign({},e,{label:e.label,matchOn:e.matchOn||e.label,value:e.value||e.label})}));var l=document.createElement("div"),o=e.className,u=e.id,i={width:e.offsetWidth.toString()+"px",showDropdown:!0,selected:null,inputRef:null,inputId:u||"",inputClass:o||"",inputVal:"",choice:null,cache:{},filtered:[],all:n||[],matchFullWord:t.matchFullWord||!1,minChars:t.minChars||3,maxResults:t.maxResults||7,divClass:t.divClass||"",dropdownClass:t.dropdownClass||"",ulClass:t.ulClass||"",liClass:t.liClass||"",enterEvent:t.enterEvent||null,valueEvent:t.valueEvent||null,renderItem:t.renderItem||null,selectEvent:t.selectEvent||null,events:t.events||null,source:t.source||null};e.insertAdjacentElement("afterend",l),e.style.display="none";this.application=c(i,a,function(){return s()},l)}return e.prototype.isObject=function(e){return null!==e&&e.constructor===Object},e}();
